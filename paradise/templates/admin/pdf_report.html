<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Paradise Hotel ‚Äî Bookings Report</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    /* Basic layout + improved PDF rules */
    @page { size: A4; margin: 18mm 12mm; }
    /* Embed a common sans fallback; if you have a TTF you want to embed, add @font-face here */
    /* Example (uncomment and provide path accessible to WeasyPrint):
    @font-face {
      font-family: "InterVar";
      src: url("file:///usr/share/fonts/truetype/your-font.ttf") format("truetype");
      font-weight: normal;
      font-style: normal;
    }
    */
    body { font-family: Arial, Helvetica, sans-serif; color: #222; margin: 0; padding: 18px; font-size: 13px; }
    header { text-align: center; margin-bottom: 6px; }
    h1 { margin: 0; font-size: 20px; color: #0d6efd; }
    h2 { margin: 4px 0 12px 0; font-size: 15px; color: #333; }
    h3 { margin: 14px 0 6px 0; color: #0d6efd; font-size: 14px; }

    .summary { display: flex; flex-wrap: wrap; gap: 10px; justify-content: space-between; margin-bottom: 10px; }
    .stat { min-width: 150px; background: #f8f9fa; border: 1px solid #e9ecef; padding: 8px 10px; border-radius: 6px; }
    .stat b { display: block; font-size: 12px; color: #555; }
    .stat .value { font-size: 18px; margin-top: 6px; font-weight: 700; color: #111; }

    .kpis { margin-top: 8px; }
    .kpis ul { margin: 6px 0 0 18px; padding: 0; }

    .charts-grid { width: 100%; border-collapse: collapse; margin-top: 10px; }
    .charts-grid td { vertical-align: top; padding: 8px; width: 50%; }
    .chart-title { font-size: 13px; margin: 6px 0; color: #0d6efd; }
    img.chart { display: block; max-width: 100%; height: auto; border: 1px solid #eee; padding: 6px; background: #fff; }

    table.bookings { width: 100%; border-collapse: collapse; margin-top: 12px; font-size: 12px; }
    table.bookings th, table.bookings td { border: 1px solid #ddd; padding: 6px 8px; text-align: left; vertical-align: top; }
    table.bookings th { background: #0d6efd; color: #fff; font-weight: 600; font-size: 12px; }
    table.bookings tbody tr:nth-child(even) td { background: #fafafa; }

    /* Page break helpers for WeasyPrint */
    .page-break { page-break-after: always; }
    thead { display: table-header-group; }
    tfoot { display: table-row-group; }

    /* Keep charts from being split awkwardly */
    .chart-block { page-break-inside: avoid; }

    .footer { margin-top: 18px; color: #666; font-size: 11px; text-align: center; }
  </style>
</head>
<body>
  <header role="banner" aria-label="Report header">
    <h1>üè® Paradise Hotel</h1>
    <h2>Bookings Report</h2>

    {% if filter_start and filter_end %}
      <div aria-label="Report period">Period: {{ filter_start }} ‚Äî {{ filter_end }}</div>
    {% elif filter_end %}
      <div aria-label="Report date">As of: {{ filter_end }}</div>
    {% elif today %}
      <div aria-label="Report date">As of: {{ today }}</div>
    {% endif %}
  </header>

  <section class="summary" role="region" aria-label="Summary stats">
    <div class="stat" role="status" aria-atomic="true">
      <b>Total rooms</b>
      <div class="value">{{ total_rooms|default:"0" }}</div>
    </div>
    <div class="stat" role="status" aria-atomic="true">
      <b>Total bookings</b>
      <div class="value">{{ total_bookings|default:"0" }}</div>
    </div>
    <div class="stat" role="status" aria-atomic="true">
      <b>Today's check-ins</b>
      <div class="value">{{ today_checkins|default:"0" }}</div>
    </div>
    <div class="stat" role="status" aria-atomic="true">
      <b>Today's check-outs</b>
      <div class="value">{{ today_checkouts|default:"0" }}</div>
    </div>
  </section>

  <section class="kpis" aria-label="Key performance indicators">
    <h3>Key performance indicators</h3>
    <div><b>Average stay:</b> {{ avg_stay_days|default:"0" }} days</div>
    <div><b>Occupancy rate (period):</b> {{ occupancy_rate|default:"0" }}%</div>

    <div style="margin-top:6px;">
      <b>Revenue by room type</b>
      <ul class="revenue-list" aria-label="Revenue by room type">
        {% for r in revenue_per_type %}
          <li>{{ r.room__room_type }} ‚Äî {{ r.total_revenue|default:"0" }}</li>
        {% empty %}
          <li>No revenue data.</li>
        {% endfor %}
      </ul>
    </div>
  </section>

  <section class="chart-block" aria-label="Charts">
    <h3>Charts</h3>
    <table class="charts-grid" role="presentation" aria-hidden="false">
      <tr>
        <td>
          <div class="chart-title">Weekly bookings</div>
          {% if chart_svg %}
            {% autoescape off %}{{ chart_svg }}{% endautoescape %}
          {% elif chart %}
            <img class="chart" src="data:image/png;base64,{{ chart }}" alt="Weekly bookings" />
          {% else %}
            <div>No weekly bookings chart available.</div>
          {% endif %}
        </td>

        <td>
          <div class="chart-title">Bookings per room type</div>
          {% if room_chart_svg %}
            {% autoescape off %}{{ room_chart_svg }}{% endautoescape %}
          {% elif room_chart %}
            <img class="chart" src="data:image/png;base64,{{ room_chart }}" alt="Bookings per room type" />
          {% else %}
            <div>No room type chart available.</div>
          {% endif %}
        </td>
      </tr>

      <tr>
        <td>
          <div class="chart-title">Occupancy (period)</div>
          {% if occupancy_chart %}
            <img class="chart" src="data:image/png;base64,{{ occupancy_chart }}" alt="Occupancy chart" />
          {% else %}
            <div>No occupancy chart available.</div>
          {% endif %}
        </td>

        <td>
          <div class="chart-title">Revenue trend (daily)</div>
          {% if revenue_chart %}
            <img class="chart" src="data:image/png;base64,{{ revenue_chart }}" alt="Revenue trend chart" />
          {% else %}
            <div>No revenue trend chart available.</div>
          {% endif %}
        </td>
      </tr>

      <tr>
        <td colspan="2">
          <div class="chart-title">Bookings by source</div>
          {% if source_chart %}
            <img class="chart" src="data:image/png;base64,{{ source_chart }}" alt="Bookings by source" />
          {% else %}
            <div>No bookings-by-source chart available.</div>
          {% endif %}
        </td>
      </tr>
    </table>
  </section>

  <div class="page-break"></div>

    <section aria-label="Bookings list">
      <h3>Bookings (filtered)</h3>
      <table class="bookings" role="table" aria-label="Bookings table">
        <thead>
          <tr>
            <th>Invoice #</th> <!-- ‚úÖ Added -->
            <th>Customer</th>
            <th>Room</th>
            <th>Type</th>
            <th>Source</th>
            <th>Check-in</th>
            <th>Check-out</th>
            <th>Created</th>
          </tr>
        </thead>
        <tbody>
          {% for b in bookings %}
            <tr>
              <td>{{ b.invoice_number }}</td> <!-- ‚úÖ New -->
              <td>{{ b.customer_name }}</td>
              <td>{{ b.room.room_number }}</td>
              <td>{{ b.room.room_type }}</td>
              <td>{{ b.source|default:"-" }}</td>
              <td>{{ b.check_in }}</td>
              <td>{{ b.check_out }}</td>
              <td>{{ b.created_at|date:"M d, Y H:i" }}</td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="8" style="text-align:center;">No bookings found for this filter.</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </section>


  <footer class="footer" role="contentinfo">
    Paradise Hotel ‚Ä¢ Generated on
    {% if filter_end %}{{ filter_end }}{% elif today %}{{ today }}{% else %}{{ "" }}{% endif %}.
  </footer>
</body>
</html>
